NWNXDIR  = ../..
DFLAGS   :=
CPPFLAGS = $(PLUGIN_CPPFLAGS) -I$(NWNXDIR) $(DFLAGS)
LFLAGS   = $(PLUGIN_LFLAGS)

SODEPS   := HookSCORCO.o CExoString.o ObjectStorage.o NWNXodbc.o plugin-odbc.o
LIBS     := -lz

TARGET_ANY = 0
TARGETCXX = $(CXX) $(LFLAGS) -o $@ $^ $(LIBS)

all: warn_if_no_target nwnx_odbc_mysql.so nwnx_odbc_sqlite.so nwnx_odbc_pgsql.so

nwnx_odbc_clean_o:
	-@rm *.o
nwnx_odbc_mysql.so:: nwnx_odbc_clean_o
nwnx_odbc_sqlite.so:: nwnx_odbc_clean_o
nwnx_odbc_pgsql.so:: nwnx_odbc_clean_o

ifdef MYSQL_SUPPORT
TARGETS := $(TARGETS) nwnx_odbc_mysql.so
TARGET_ANY = 1
nwnx_odbc_mysql.so:: $(SODEPS) mysql.o
	$(TARGETCXX) -DMYSQL_SUPPORT -lmysqlclient
endif

ifdef SQLITE_SUPPORT
TARGETS := $(TARGETS) nwnx_odbc_sqlite.so
TARGET_ANY = 1
nwnx_odbc_sqlite.so:: $(SODEPS) sqlite.o
	$(TARGETCXX) -DSQLITE_SUPPORT -lsqlite3
endif

ifdef PGSQL_SUPPORT
TARGETS := $(TARGETS) nwnx_odbc_pgsql.so
TARGET_ANY = 1
nwnx_odbc_pgsql.so:: $(SODEPS) pgsql.o
	$(TARGETCXX) -DPGSQL_SUPPORT -lpq
endif

.PHONY: warn_if_no_target
warn_if_no_target:
ifeq ($(TARGET_ANY),0)
	@echo ""
	@echo "************************************"
	@echo "              WARNING "
	@echo "You don't have any targets selected."
	@echo "No database plugin is being built."
	@echo " See README in the odbmc directory."
	@echo "************************************"
	@echo ""
endif

clean:
	/bin/rm -f *.o *.so *~

distclean: clean
	/bin/rm -f Makefile

# automatic installation not supported, since the user needs to
# select a plugin
